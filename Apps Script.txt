function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const spreadsheetId = '12kop7HZ3Qne_sVgdADn7T4kZn0QfW7rwD2EAPkd7U4c'; // Ganti dengan ID spreadsheet Anda
    const sheet = SpreadsheetApp.openById(spreadsheetId).getActiveSheet();
    
    // Setup header jika sheet kosong
    if (sheet.getLastRow() === 0) {
      sheet.getRange(1, 1, 1, 8).setValues([
        ['Nama', 'Sekolah', 'Bulan', 'Tahun', 'Jumlah', 'Keterangan', 'Tanggal Input', 'Timestamp']
      ]);
    }
    
    // Tambah data baru
    if (data.action === 'add') {
      sheet.appendRow([
        data.nama,
        data.sekolah, 
        data.bulan,
        data.tahun,
        data.jumlah,
        data.keterangan,
        data.tanggalInput,
        new Date()
      ]);
    }
    
    // Sinkronkan semua data
    if (data.action === 'sync') {
      // Hapus data lama (kecuali header)
      if (sheet.getLastRow() > 1) {
        sheet.deleteRows(2, sheet.getLastRow() - 1);
      }
      
      // Tambah semua data
      data.allData.forEach(item => {
        sheet.appendRow([
          item.nama,
          item.sekolah,
          item.bulan, 
          item.tahun,
          item.jumlah,
          item.keterangan,
          item.tanggalInput,
          new Date()
        ]);
      });
    }
    
    return ContentService
      .createTextOutput(JSON.stringify({success: true}))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({success: false, error: error.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function doGet() {
  return ContentService
    .createTextOutput('KKG PAI Iuran API is running')
    .setMimeType(ContentService.MimeType.TEXT);
}